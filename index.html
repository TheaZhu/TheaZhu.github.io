<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta property="og:type" content="website">
<meta property="og:title" content="Thea loves android">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Thea loves android">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Thea loves android">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/"/>

  <title> Thea loves android </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Thea loves android</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/25/Android开发笔记/Android开发笔记 - 自定义View/" itemprop="url">
                  Unbenannt
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-09-25T20:20:48+08:00" content="2016-09-25">
              2016-09-25
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Android开发笔记"><a href="#Android开发笔记" class="headerlink" title="Android开发笔记"></a>Android开发笔记</h1><p><br></p>
<h2 id="onMeasure"><a href="#onMeasure" class="headerlink" title="onMeasure()"></a>onMeasure()</h2><p>三种测量模式：MeasureSpec.EXACTLY、MeasureSpec.UNSPECIFIED和MeasureSpec.AT_MOST。这三种测量模式分别对应三种情况：View有确定的宽高（包括match_parent和具体值两种情况），此时使用EXACTLY，直接把MeasureSpec.getSize()返回就行;View没有确定的宽高（即wrap_content），此时可能系统会使用MeasureSpec.UNSPECIFIED或者MeasureSpec.AT_MOST。在MeasureSpec.UNSPECIFIED中我们把尽量容纳View的尺寸返回给父View去处理，而在MeasureSpec.AT_MOST中则由于父View对子View的限制需要比对父View的限制的最大情况和子View尽可能容纳的尺寸，然后返回相对较小的值。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/25/Android开发笔记/Android开发笔记 - 权限管理/" itemprop="url">
                  Unbenannt
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-09-25T20:20:48+08:00" content="2016-09-25">
              2016-09-25
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Android开发笔记-权限管理"><a href="#Android开发笔记-权限管理" class="headerlink" title="Android开发笔记-权限管理"></a>Android开发笔记-权限管理</h1><p>Android 6.0对用户权限管理机制进行了改善。不再像之前一样在首次安装应用时处理权限请求，现在的权限设置只有在应用需要使用该功能的时候才会申请该权限，也就是我们所说的运行时权限。</p>
<p>如果App暂未支持运行时权限，最好将targetSdkVersion设置为23以下，系统将会以旧的权限管理系统来处理，否则在Android 6.0系统上运行时可能会出问题。</p>
<h2 id="权限分组"><a href="#权限分组" class="headerlink" title="权限分组"></a>权限分组</h2><hr>
<p>Android开发中，在使用某些特定功能时需要申请权限，但并非所以权限都是敏感权限，系统对权限进行了分类：</p>
<ul>
<li>正常权限(Normal Permissions)</li>
<li>危险权限(Dangerous Permissions)</li>
<li>特殊权限(Particular Permissions)</li>
<li>其他权限(一般很少用到)</li>
</ul>
<h2 id="正常权限-Normal-Permissions"><a href="#正常权限-Normal-Permissions" class="headerlink" title="正常权限(Normal Permissions)"></a>正常权限(Normal Permissions)</h2><hr>
<ul>
<li><p>特点： 对用户隐私或设备操作没有较大影响。</p>
</li>
<li><p>申请方式： 直接在AndroidManifest.xml文件中声明。</p>
<pre><code>&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    package=&quot;com.android.app.myapp&quot; &gt;

    &lt;uses-permission android:name=&quot;android.permission.RECEIVE_SMS&quot; /&gt;
    ...
&lt;/manifest&gt;
</code></pre></li>
<li><p>管理方式： 系统将自动为App赋予这些权限，不需要显示的提醒用户。</p>
</li>
<li><p>权限列表：所涉及到的基本是关于网络、蓝牙、时区、快捷方式等方面。</p>
<pre><code>ACCESS_LOCATION_EXTRA_COMMANDS
ACCESS_NETWORK_STATE
ACCESS_NOTIFICATION_POLICY
ACCESS_WIFI_STATE
BLUETOOTH
BLUETOOTH_ADMIN
BROADCAST_STICKY
CHANGE_NETWORK_STATE
CHANGE_WIFI_MULTICAST_STATE
CHANGE_WIFI_STATE
DISABLE_KEYGUARD
EXPAND_STATUS_BAR
GET_PACKAGE_SIZE
INTERNET
KILL_BACKGROUND_PROCESSES
MODIFY_AUDIO_SETTINGS
NFC
READ_SYNC_SETTINGS
READ_SYNC_STATS
RECEIVE_BOOT_COMPLETED
REORDER_TASKS
REQUEST_INSTALL_PACKAGES
SET_TIME_ZONE
SET_WALLPAPER
SET_WALLPAPER_HINTS
TRANSMIT_IR
USE_FINGERPRINT
VIBRATE
WAKE_LOCK
WRITE_SYNC_SETTINGS
SET_ALARM
INSTALL_SHORTCUT
UNINSTALL_SHORTCUT
</code></pre></li>
</ul>
<h2 id="危险权限-Dangerous-Permissions"><a href="#危险权限-Dangerous-Permissions" class="headerlink" title="危险权限(Dangerous Permissions)"></a>危险权限(Dangerous Permissions)</h2><hr>
<ul>
<li><p>特点： 可能会对用户隐私或设备的正常操作造成影响。是运行时权限主要处理的对象。</p>
</li>
<li><p>申请方式： 当App运行时需要该权限时申请。每次需要权限是都要检查是否有被授予，如果没有则需要询问用户。 </p>
<pre><code>private static final int REQUEST_READ_CONTACTS_PERMISSION = 22;

@Override
public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {
    // 权限请求回调
    switch (requestCode) {
        case REQUEST_READ_CONTACTS_PERMISSION:
            // 读取联系人权限成功获取
            if (grantResults.length &gt; 0 &amp;&amp; grantResults[0] ==  PackageManager.PERMISSION_GRANTED)
                queryContacts();
            else
                Toast.makeText(this, &quot;没有读取联系人权限&quot;, Toast.LENGTH_SHORT).show();
            break;
    }
}

public boolean checkPermission(String permission) {
    // 判断是否有权限
    int permissionCheck = ContextCompat.checkSelfPermission(
            this, permission);
    if (permissionCheck != PackageManager.PERMISSION_GRANTED) {        // 没有获取权限
        // 判断是否应该说明申请权限的理由
        boolean shouldShowRationale = ActivityCompat.shouldShowRequestPermissionRationale(
                this, Manifest.permission.READ_CONTACTS);
        Log.i(TAG, &quot;rationale: &quot; + shouldShowRationale);
        if (shouldShowRationale) {
            // 说明理由，等待用户反馈，再申请权限
        }
        // 发起申请权限请求
        ActivityCompat.requestPermissions(this, new String[]{permission},
                REQUEST_READ_CONTACTS_PERMISSION);
    }
    return permissionCheck == PackageManager.PERMISSION_GRANTED;
}

public void getContacts(View view) {
    if (Build.VERSION.SDK_INT &lt; 23 || checkPermission(Manifest.permission.READ_CONTACTS))
        queryContacts();
}

public void queryContacts() {
    Cursor cursor = getContentResolver().query(
            ContactsContract.Contacts.CONTENT_URI,
            new String[]{ContactsContract.Contacts._ID, ContactsContract.Contacts.DISPLAY_NAME},
            null, null, ContactsContract.Contacts.SORT_KEY_PRIMARY);

    if (cursor == null)
        return;

    while (cursor.moveToNext()) {
        Log.i(TAG, &quot;id: &quot; + cursor.getString(0) + &quot;, name: &quot; + cursor.getString(1));
    }

    cursor.close();
}
</code></pre></li>
</ul>
<ul>
<li><p>管理方式： 系统需要用户显示的授予这些权限，且用户随时可以撤回授予的权限。</p>
</li>
<li><p>分组： 系统对权限进行了分组(Group)，属于同一组的权限互相绑定，一旦组内某个权限被允许，该组的其他权限也将允许。</p>
</li>
</ul>
<ul>
<li><p>注意：</p>
<ol>
<li><p>当程序支持Android 6.0时，也要兼容以前的版本。</p>
</li>
<li><p>Fragment中申请权限时，不要使用ActivityCompat.requestPermissions, 直接使用Fragment的requestPermissions方法，否则会回调到Activity的onRequestPermissionsResult</p>
</li>
<li><p>（此问题23.3版本库已修复） ~~如果在Fragment中嵌套Fragment，在子Fragment中使用requestPermissions方法，onRequestPermissionsResult不会回调回来，建议使用getParentFragment().requestPermissions方法，<br>这个方法会回调到父Fragment中的onRequestPermissionsResult，加入以下代码可以把回调透传到子Fragment ~~</p>
<pre><code>@Override
public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) {
    super.onRequestPermissionsResult(requestCode, permissions, grantResults);
    List&lt;Fragment&gt; fragments = getChildFragmentManager().getFragments();
    if (fragments != null) {
        for (Fragment fragment : fragments) {
            if (fragment != null)
                fragment.onRequestPermissionsResult(requestCode,permissions,grantResults);
        }
    }
}
</code></pre></li>
</ol>
</li>
<li><p>权限列表：</p>
</li>
</ul>
<p><img src="https://github.com/TheaZhu/TheaZhu.github.io/blob/master/images/study_notes/dangerous_permissions.png" alt=""></p>
<h2 id="特殊权限-Particular-Permissions"><a href="#特殊权限-Particular-Permissions" class="headerlink" title="特殊权限(Particular Permissions)"></a>特殊权限(Particular Permissions)</h2><hr>
<ul>
<li><p>特点： 对系统来说是特别敏感的权限。</p>
</li>
<li><p>权限列表：</p>
<pre><code>SYSTEM_ALERT_WINDOW   // 设置悬浮窗，进行一些黑科技
WRITE_SETTINGS   // 修改系统设置        
</code></pre></li>
<li><p>申请方式：在需要使用时，使用startActivityForResult启动授权界面来完成。</p>
</li>
</ul>
<h2 id="相关开源框架"><a href="#相关开源框架" class="headerlink" title="相关开源框架"></a>相关开源框架</h2><hr>
<p><a href="https://github.com/hotchemi/PermissionsDispatcher" target="_blank" rel="external">PermissionsDispatcher</a></p>
<p><a href="https://github.com/tbruyelle/RxPermissions" target="_blank" rel="external">RxPermissions</a></p>
<p><a href="https://github.com/anthonycr/Grant" target="_blank" rel="external">Grant</a></p>
<p><a href="https://github.com/googlesamples/android-RuntimePermissions" target="_blank" rel="external">android-RuntimePermissions</a></p>
<h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p><a href="http://developer.android.com/guide/topics/security/permissions.html" target="_blank" rel="external">System Permissions</a></p>
<p><a href="http://developer.android.com/training/permissions/requesting.html" target="_blank" rel="external">Requesting Permissions at Run Time</a></p>
<p><a href="http://droidyue.com/blog/2016/01/17/understanding-marshmallow-runtime-permission/index.html" target="_blank" rel="external">聊一聊Android 6.0的运行时权限</a></p>
<p><a href="https://www.aswifter.com/2015/11/04/android-6-permission/" target="_blank" rel="external">Android 6.0 运行时权限处理</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/25/Android开发笔记/Android开发笔记 - 插件化/" itemprop="url">
                  Unbenannt
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-09-25T20:20:48+08:00" content="2016-09-25">
              2016-09-25
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Android开发笔记-插件化"><a href="#Android开发笔记-插件化" class="headerlink" title="Android开发笔记-插件化"></a>Android开发笔记-插件化</h1><p><br></p>
<h2 id="难点"><a href="#难点" class="headerlink" title="难点"></a>难点</h2><ol>
<li><p>资源访问 - 无法通过宿主程序的Context取到插件apk中的资源</p>
</li>
<li><p>Activity生命周期 - apk被宿主程序加载执行后，它的activity其实就是一个普通的类，宿主程序需要替代系统对apk中的activity的生命周期进行管理</p>
</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/25/Android开发笔记/Android开发笔记 - 性能优化/" itemprop="url">
                  Unbenannt
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-09-25T20:20:48+08:00" content="2016-09-25">
              2016-09-25
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Android开发笔记-性能优化"><a href="#Android开发笔记-性能优化" class="headerlink" title="Android开发笔记 - 性能优化"></a>Android开发笔记 - 性能优化</h1><p>响应速度，内存泄漏，内存溢出，代码的可维护性和可扩展性</p>
<h2 id="布局优化"><a href="#布局优化" class="headerlink" title="布局优化"></a>布局优化</h2><h2 id="绘制优化"><a href="#绘制优化" class="headerlink" title="绘制优化"></a>绘制优化</h2><h2 id="内存泄漏优化"><a href="#内存泄漏优化" class="headerlink" title="内存泄漏优化"></a>内存泄漏优化</h2><h2 id="响应速度优化"><a href="#响应速度优化" class="headerlink" title="响应速度优化"></a>响应速度优化</h2><h2 id="ListView优化"><a href="#ListView优化" class="headerlink" title="ListView优化"></a>ListView优化</h2><h2 id="Bitmap优化"><a href="#Bitmap优化" class="headerlink" title="Bitmap优化"></a>Bitmap优化</h2><h2 id="线程优化"><a href="#线程优化" class="headerlink" title="线程优化"></a>线程优化</h2><h2 id="优化建议"><a href="#优化建议" class="headerlink" title="优化建议"></a>优化建议</h2><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/25/Android开发笔记/Android开发笔记 - 必备工具/" itemprop="url">
                  Unbenannt
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-09-25T20:20:48+08:00" content="2016-09-25">
              2016-09-25
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Android开发笔记-必备工具"><a href="#Android开发笔记-必备工具" class="headerlink" title="Android开发笔记-必备工具"></a>Android开发笔记-必备工具</h1><p><br></p>
<h2 id="Android-Studio常用插件"><a href="#Android-Studio常用插件" class="headerlink" title="Android Studio常用插件"></a>Android Studio常用插件</h2><hr>
<ul>
<li>Lifecycle Sorter</li>
<li>GsonFormat</li>
<li>Android Parcelable code generator</li>
<li>Android Material Design Icon Generator</li>
<li>Android Drawable Importer</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/25/Android开发笔记/Android开发笔记 - 开源库/" itemprop="url">
                  Unbenannt
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-09-25T20:20:48+08:00" content="2016-09-25">
              2016-09-25
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Android开发笔记-开源库"><a href="#Android开发笔记-开源库" class="headerlink" title="Android开发笔记-开源库"></a>Android开发笔记-开源库</h1><p><br></p>
<h3 id="1-json解析"><a href="#1-json解析" class="headerlink" title="1. json解析"></a>1. json解析</h3><ul>
<li><a href="https://github.com/google/gson" target="_blank" rel="external">Gson</a></li>
</ul>
<h3 id="2-网络通信"><a href="#2-网络通信" class="headerlink" title="2. 网络通信"></a>2. 网络通信</h3><ul>
<li><p><a href="https://github.com/square/okhttp" target="_blank" rel="external">OkHttp</a></p>
</li>
<li><p><a href="https://github.com/square/retrofit" target="_blank" rel="external">Retrofit</a></p>
</li>
<li><p><a href="">volley</a></p>
</li>
</ul>
<h3 id="3-图片加载"><a href="#3-图片加载" class="headerlink" title="3. 图片加载"></a>3. 图片加载</h3><ul>
<li><p><a href="https://github.com/square/picasso" target="_blank" rel="external">Picasso</a></p>
</li>
<li><p><a href="https://github.com/facebook/fresco" target="_blank" rel="external">Fresco</a></p>
</li>
</ul>
<h3 id="4-事件总线"><a href="#4-事件总线" class="headerlink" title="4. 事件总线"></a>4. 事件总线</h3><ul>
<li><p><a href="https://github.com/ReactiveX/RxJava" target="_blank" rel="external">RxJava</a></p>
</li>
<li><p><a href="https://github.com/square/otto" target="_blank" rel="external">Otto</a></p>
</li>
<li><p><a href="https://github.com/greenrobot/EventBus" target="_blank" rel="external">EventBus</a></p>
</li>
</ul>
<h3 id="5-依赖注入"><a href="#5-依赖注入" class="headerlink" title="5. 依赖注入"></a>5. 依赖注入</h3><ul>
<li><p><a href="https://github.com/square/dagger" target="_blank" rel="external">Dagger</a></p>
</li>
<li><p><a href="https://github.com/JakeWharton/butterknife" target="_blank" rel="external">ButterKnife</a></p>
</li>
</ul>
<h3 id="6-数据库"><a href="#6-数据库" class="headerlink" title="6. 数据库"></a>6. 数据库</h3><ul>
<li><p><a href="https://github.com/greenrobot/greenDAO" target="_blank" rel="external">GreenDAO</a></p>
</li>
<li><p><a href="https://github.com/j256/ormlite-android" target="_blank" rel="external">ormlite-android</a></p>
</li>
<li><p><a href="https://github.com/LitePalFramework/LitePal" target="_blank" rel="external">LitePal</a></p>
</li>
</ul>
<h3 id="7-其他"><a href="#7-其他" class="headerlink" title="7. 其他"></a>7. 其他</h3><ul>
<li>MVP - leanback</li>
<li>获取图片主要颜色 - palette</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/25/Android开发笔记/Android开发笔记 - 小技巧/" itemprop="url">
                  Unbenannt
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-09-25T20:20:48+08:00" content="2016-09-25">
              2016-09-25
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Android开发笔记-小技巧"><a href="#Android开发笔记-小技巧" class="headerlink" title="Android开发笔记-小技巧"></a>Android开发笔记-小技巧</h1><p><br></p>
<h2 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h2><hr>
<ul>
<li><code>android.text.TextUtils</code>  （字符串处理）</li>
<li><code>android.webkit.URLUtil</code>  （URL处理、类型判断）</li>
<li><code>android.net.UrlQuerySanitizer</code> （URL检查）</li>
<li><code>android.text.format.DateUtils</code>  （格式化日期、常用日期判断）</li>
<li><code>android.telephony.PhoneNumberUtils</code> （电话号码判断、处理）</li>
<li><code>android.text.util.Linkify</code>  （为文本添加超链接）</li>
<li><code>java.util.Arrays</code>  （数组处理）</li>
<li><code>java.util.Collections</code>  （集合操作）</li>
<li><code>android.media.ThumbnailUtils</code>  （获取图片、视频缩略图）</li>
</ul>
<h2 id="特殊属性"><a href="#特殊属性" class="headerlink" title="特殊属性"></a>特殊属性</h2><hr>
<h3 id="Activity属性"><a href="#Activity属性" class="headerlink" title="Activity属性"></a>Activity属性</h3><ul>
<li><p>多窗口支持</p>
<pre><code>android:configChanges=&quot;screenSize|smallestScreenSize|screenLayout|orientation&quot;
</code></pre></li>
</ul>
<h3 id="View属性"><a href="#View属性" class="headerlink" title="View属性"></a>View属性</h3><ul>
<li><p>tools命名空间： 可以用来预览，但运行时会忽略</p>
<pre><code>&lt;Button
    android:id=&quot;@+id/btn_go&quot;
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;wrap_content&quot;
    tools:text=&quot;点击跳转&quot; /&gt;
</code></pre></li>
<li><p><code>android:clipToPadding</code>是否允许在padding中绘制，默认true，不允许。</p>
</li>
<li><p><code>android:includeFontPadding=&quot;false&quot;</code>TextView默认上下是有一定的padding的，不需要上下这部分留白时加上它即可。</p>
</li>
<li><p><code>android:transcriptMode=&quot;normal&quot;</code> ListView避免软键盘遮挡。</p>
</li>
<li><p><code>android:animateLayoutChanges=&quot;true&quot;</code> LinearLayout中添加View的动画的办法，支持通过setLayoutTransition()自定义动画。父布局加上此属性后，如果触发了layout方法（比如它的子View设置为GONE），系统就会自动帮你加上布局改变时的动画特效。</p>
</li>
<li><p><code>android:descendantFocusability=&quot;blocksDescendants&quot;</code>ListView的item中CheckBox等元素抢焦点导致item点击事件无法响应时，除了给对应的元素设置 focusable，更简单的是在item根布局加上此属性。</p>
</li>
</ul>
<h3 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h3><ul>
<li><code>android:fillAfter=&quot;true&quot;</code> 动画结束后不恢复原状。</li>
</ul>
<h2 id="特殊方法"><a href="#特殊方法" class="headerlink" title="特殊方法"></a>特殊方法</h2><hr>
<ul>
<li><p><code>ThumbnailUtils.extractThumbnail(source, width, height);</code> 图片压缩</p>
</li>
<li><p><code>Resources.getSystem().getDisplayMetrics().density</code> 获取屏幕密度</p>
</li>
<li><p><code>TypedValue.applyDimension(unit, value, metrics);</code> dp, px, sp转换</p>
</li>
<li><p>蒙版效果。通过重载 <code>ViewGroup</code> 的 <code>dispatchDraw</code> 可以实现一个简单的蒙版效果。 例如下拉刷新时，可以在 contentView 上加一层遮罩。 </p>
<pre><code>canvas.drawRect(0, mContentView.getTranslationY(), getWidth(), getHeight(), mMaskPaint);
</code></pre></li>
<li><p><code>View.generateViewId();</code> 为new出来的view生成唯一id。</p>
</li>
<li><p><code>Resources.getIdentifier(name, defType, defPackage);</code> 根据资源名称获取id</p>
</li>
<li><p><code>view.isShown();</code> 判断view是否可见，只有当view本身以及它的所有祖先们都是visible时，isShown（）才返回TRUE。</p>
</li>
<li><p><code>getParent().requestDisallowInterceptTouchEvent(true);</code>剥夺父view对touch事件的处理权。</p>
</li>
<li><p><code>TextView.setTransformationMethod(method);</code> 可用来实现“显示密码”功能。</p>
</li>
<li><p><code>ViewPager.setPageTransformer(boolean, pageTransformer);</code> 设置页面切换动画。PageTransformer接口用来自定义页面切换动画。</p>
</li>
<li><p><code>ArgbEvaluator.evaluate(fraction, startValue, endValue);</code>根据一个起始颜色值和一个结束颜色值以及一个偏移量生成一个新的颜色。</p>
</li>
<li><p><code>ValueAnimator.reverse();</code> 动画倒退，顺畅的取消动画效果。</p>
</li>
<li><p><code>Formatter.formatFileSize(context, sizeBytes);</code> 格式化数据的大小，根据输入的字节大小，返回 B KB MB GB 等等（最大支持到 PB）。当然要注意的是输入的最大值是 Long.MAX_VALUE。</p>
</li>
<li><p><code>Executors.newSingleThreadExecutor();</code> 单线程顺序执行的任务队列。</p>
</li>
</ul>
<h2 id="小小注意点"><a href="#小小注意点" class="headerlink" title="小小注意点"></a>小小注意点</h2><hr>
<ul>
<li><p>静态变量不要直接或者间接引用Activity、Service等。这会使用Activity以及它所引用的所有对象无法释放，然后，用户操作时间一长，内存就会狂升。</p>
</li>
<li><p>Handler机制有一个特点是不会随着Activity、Service的生命周期结束而结束。也就是说，如果你Post了一个Delay的Runnable，然后在Runnable执行之前退出了Activity，Runnable到时间之后还是要执行的。如果Runnable里面包含更新View的操作，程序崩溃了。</p>
</li>
<li><p>模块间有消息需要传递时，使用LocalBroadcastManager替代Listener进行模块解耦。除了解耦，这样发送消息和执行消息差一个线程循环，可以减小方法的调用链，我这就碰到一次方法调用链太长导致StackOverflow的问题。</p>
</li>
<li><p>ActivityOptions ——方便的定义两个Activity切换的动画。 使用ActivityOptionsCompat 可以很好解决旧版本的兼容问题。</p>
</li>
<li><p>TouchDelegate可用于更改View的触摸区域。场景：比如在RecyclerView的ItemView里包含了CheckBox组件, 然后想实现点击ItemView的时候，也可以触发CheckBox，就可以使用此类。</p>
</li>
<li><p>ViewDragHelper自定义ViewGroups的工具类，处理触摸事件的神器。 </p>
</li>
<li><p>apache提供的一系列jar包：commons-lang.jar，commons-collections.jar，commons-beanutils.jar等，里面很多方法可能是你曾经用几十几百行代码实现过的，但是执行效率或许要差很多，比如：ArrayUtils，StringUtils等。</p>
</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><hr>
<p><a href="https://github.com/jiang111/awesome-android-tips" target="_blank" rel="external">https://github.com/jiang111/awesome-android-tips</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/25/Android开发笔记/Android开发笔记 - xml/" itemprop="url">
                  Unbenannt
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-09-25T20:20:48+08:00" content="2016-09-25">
              2016-09-25
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Android开发笔记-xml"><a href="#Android开发笔记-xml" class="headerlink" title="Android开发笔记-xml"></a>Android开发笔记-xml</h1><p><br></p>
<h2 id="特殊符号"><a href="#特殊符号" class="headerlink" title="特殊符号"></a>特殊符号</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/25/Android开发笔记/Android开发笔记 - VectorDrawable/" itemprop="url">
                  Unbenannt
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-09-25T20:20:48+08:00" content="2016-09-25">
              2016-09-25
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Android开发笔记-VectorDrawable"><a href="#Android开发笔记-VectorDrawable" class="headerlink" title="Android开发笔记-VectorDrawable"></a>Android开发笔记-VectorDrawable</h1><p><br></p>
<p>矢量图形(VectorDrawable)使用几何形状的方式来描述图像元素。矢量图形非常适合于与设备无关的简单或者合成的制图或者不需要实现真实感的场合。矢量图形的渲染是在运行时开始的，因此它可以自适应不同的屏幕，放大不会失真。</p>
<p>Android系统从5.0开始支持矢量图，为我们提供了添加复杂矢量图形的强大功能，同时也提供了动画显示这些图形的方法。</p>
<h2 id="VectorDrawable"><a href="#VectorDrawable" class="headerlink" title="VectorDrawable"></a>VectorDrawable</h2><hr>
<p>在Android项目中，创建一个矢量图形，只需要在res/drawable新建xml文件，在<vector\>元素下定义VectorDrawable的形状。下面的例子定义了一个心形的vector drawable:</vector\></p>
<pre><code>&lt;vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:width=&quot;256dp&quot;
    android:height=&quot;256dp&quot;
    android:viewportHeight=&quot;32&quot;
    android:viewportWidth=&quot;32&quot;&gt;        

    &lt;group
        android:name=&quot;group_love&quot;
        android:pivotX=&quot;15.0&quot;
        android:pivotY=&quot;15.0&quot;&gt;

        &lt;path
            android:fillColor=&quot;@color/pink_500&quot;
            android:pathData=&quot;M20.5,9.5
                            c-1.955,0,-3.83,1.268,-4.5,3
                            c-0.67,-1.732,-2.547,-3,-4.5,-3
                            C8.957,9.5,7,11.432,7,14
                            c0,3.53,3.793,6.257,9,11.5
                            c5.207,-5.242,9,-7.97,9,-11.5
                            C25,11.432,23.043,9.5,20.5,9.5z&quot; /&gt;
    &lt;/group&gt;
&lt;/vector&gt;
</code></pre><p>VectorDrawable通过<path\>标签来定义一条路径，<group\>标签可以用来给path分组，为我们对路径的组合操作提供方便。</group\></path\></p>
<h3 id="pathData"><a href="#pathData" class="headerlink" title="pathData"></a>pathData</h3><p>pathData定义了vector drawable的路径，它的值是绘制一个图形所需要的信息。</p>
<p>可用于定义路径(Path)的命令有：</p>
<ul>
<li>M = move to (移动到，从某点开始)</li>
<li>L = line to (从上一点画直线到)</li>
<li>H = horizontal line to (水平画直线到)</li>
<li>V = vertical line to (垂直画直线到)</li>
<li>C = curve to (画曲线到)</li>
<li>S = smooth curve to (画平滑曲线到)</li>
<li>Q = quadratic Belzier curve (二次方程曲线)</li>
<li>T = smooth quadratic Belzier curve (平滑二次方程曲线)</li>
<li>A = elliptical Arc (画椭圆)</li>
<li>Z = close path (关闭路径，直线连接终点与起点)</li>
</ul>
<p><strong>注释</strong>： 以上所有命令均允许小写字母。大写表示绝对定位，小写表示相对定位。</p>
<p>了解pathData有一定的必要，但让我们自己去想办法使用pathData去绘制复杂的图形有一定的困难，推荐两个有用的工具：</p>
<ul>
<li>矢量图形制作工具：Adobe Illustrator; Inkscape</li>
<li><a href="http://www.shejidaren.com/8000-flat-icons.html" target="_blank" rel="external">8000个已分类好的扁平化图标</a></li>
</ul>
<p>VectorDrawable的pathData解析规则与svg相似，我们只需要生成或下载需要的图形的svg文件，复制里面的path即可得到想要的VectorDrawable。</p>
<h2 id="AnimatedVectorDrawable"><a href="#AnimatedVectorDrawable" class="headerlink" title="AnimatedVectorDrawable"></a>AnimatedVectorDrawable</h2><hr>
<p>AnimatedVectorDrawable是用来实现有动画效果的VectorDrawable的，它可以让<vector\>里的<group\>和<path\>元素的属性动态变化。基本的动画效果有平移、旋转、放大缩小、以及路径绘制、形状变换。</path\></group\></vector\></p>
<p>创建一个AnimatedVectorDrawable，需要：</p>
<ul>
<li><p>存在一个要实现动画效果的VectorDrawable</p>
</li>
<li><p>存在一个或多个<a href="http://developer.android.com/guide/topics/graphics/prop-animation.html" target="_blank" rel="external">属性动画</a>文件</p>
</li>
<li><p>然后在res/drawable新建xml文件，在<animated-vector\>元素下定义VectorDrawable的动画。</animated-vector\></p>
</li>
</ul>
<p>下面的例子定义了心形vector drawable的动画：</p>
<pre><code>//anim_love_bounce.xml
&lt;set xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;

    &lt;objectAnimator
        android:duration=&quot;1000&quot;
        android:propertyName=&quot;scaleX&quot;
        android:valueFrom=&quot;0.6&quot;
        android:valueTo=&quot;1&quot;
        android:valueType=&quot;floatType&quot;
        android:repeatMode=&quot;reverse&quot;
        android:repeatCount=&quot;infinite&quot;
        android:interpolator=&quot;@android:interpolator/bounce&quot;/&gt;

    &lt;objectAnimator
        android:duration=&quot;1000&quot;
        android:propertyName=&quot;scaleY&quot;
        android:valueFrom=&quot;0.6&quot;
        android:valueTo=&quot;1&quot;
        android:valueType=&quot;floatType&quot;
        android:repeatMode=&quot;reverse&quot;
        android:repeatCount=&quot;infinite&quot;
        android:interpolator=&quot;@android:interpolator/bounce&quot; /&gt;
&lt;/set&gt;


//avd_love.xml
&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;animated-vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:drawable=&quot;@drawable/vd_love&quot;&gt;

    &lt;target
        android:animation=&quot;@animator/anim_love_bounce&quot;
        android:name=&quot;group_love&quot; /&gt;

&lt;/animated-vector&gt;
</code></pre><p><strong>注意</strong>： <path\>是没有平移(translateX,translateY)、旋转(rotation)、放大缩小(scaleX,scaleY)属性的，因此无法使用属性动画来控制<path\>实现平移、旋转、放大缩小动画；当我们需要实现这些动画时，需要先将相关的<path\>元素包裹在一个个的<group>元素中。</group></path\></path\></path\></p>
<h3 id="路径绘制动画"><a href="#路径绘制动画" class="headerlink" title="路径绘制动画"></a>路径绘制动画</h3><pre><code>&lt;objectAnimator xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:duration=&quot;800&quot;
    android:interpolator=&quot;@android:interpolator/linear_out_slow_in&quot;
    android:propertyName=&quot;trimPathStart&quot;
    android:valueFrom=&quot;0&quot;
    android:valueTo=&quot;1&quot;
    android:valueType=&quot;floatType&quot; /&gt;
</code></pre><h3 id="形状变换动画"><a href="#形状变换动画" class="headerlink" title="形状变换动画"></a>形状变换动画</h3><pre><code>&lt;objectAnimator    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:duration=&quot;3000&quot;
    android:propertyName=&quot;pathData&quot;
    android:valueFrom=&quot;M300,70 l 0,-70 70,70 0,0   -70,70z&quot;
    android:valueTo=&quot;M300,70 l 0,-70 70,0  0,140 -70,0 z&quot;
    android:valueType=&quot;pathType&quot; /&gt;
</code></pre><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><hr>
<ul>
<li><p><a href="http://chinagdg.org/2016/03/android-support-library-23-2/" target="_blank" rel="external">Android Support Library 23.2</a></p>
</li>
<li><p><a href="http://jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0123/2346.html" target="_blank" rel="external">VectorDrawable：适应不同分辨率的drawable资源</a></p>
</li>
<li><p><a href="http://www.w3school.com.cn/svg/svg_path.asp" target="_blank" rel="external">SVG - path</a></p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/25/Android开发笔记/Android开发笔记 - okhttp3/" itemprop="url">
                  Unbenannt
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-09-25T20:20:48+08:00" content="2016-09-25">
              2016-09-25
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Android开发笔记-okhttp3源码解析"><a href="#Android开发笔记-okhttp3源码解析" class="headerlink" title="Android开发笔记 - okhttp3源码解析"></a><strong>Android开发笔记 - okhttp3源码解析</strong></h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><a href="http://square.github.io/okhttp/" target="_blank" rel="external">okhttp</a> 是 Square 开源的一款高效的处理网络请求的工具，是基于传输层实现应用层协议的网络框架，不仅限于处理 Http 请求。其主要特性有：</p>
<ul>
<li>从常见的连接问题中自动恢复，请求失败自动重连</li>
<li>链路复用</li>
<li>DNS扩展</li>
<li>Http2/SPDY/WebSocket协议支持</li>
<li>无缝支持GZIP来减少数据流量</li>
<li>缓存响应数据来减少重复的网络请求（Response缓存和Cookie）</li>
<li>请求拦截</li>
</ul>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>请参见<a href="http://square.github.io/okhttp/#examples" target="_blank" rel="external">okhttp官方使用教程</a>或<a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0106/2275.html" target="_blank" rel="external">okhttp使用教程</a></p>
<h2 id="总体设计"><a href="#总体设计" class="headerlink" title="总体设计"></a>总体设计</h2><p>架构图</p>
<p>OkHttpClient</p>
<p>Dispatcher, ProxySelector, Protocol, Interceptor, SocketFactory, Cache, Authenticator, ConnectionPool</p>
<p>Connection</p>
<p>Platform</p>
<p>类图</p>
<h2 id="请求处理流程"><a href="#请求处理流程" class="headerlink" title="请求处理流程"></a>请求处理流程</h2><p>流程图</p>
<p>时序图</p>
<h2 id="特性分析"><a href="#特性分析" class="headerlink" title="特性分析"></a>特性分析</h2><h3 id="缓存策略"><a href="#缓存策略" class="headerlink" title="缓存策略"></a>缓存策略</h3><p><code>InternalCache</code></p>
<p><code>Cache</code></p>
<h3 id="链路复用"><a href="#链路复用" class="headerlink" title="链路复用"></a>链路复用</h3><p><code>OkHttpClient.newCall(Request)</code></p>
<p><code>Dispatcher</code>异步请求执行策略</p>
<p><code>Cache</code>将响应缓存到文件系统</p>
<p><code>CacheStrategy</code>解决使用网络、缓存还是两者都用的问题</p>
<p><code>Interceptor</code>拦截器，该类的文档介绍如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Observes, modifies, and potentially short-circuits requests going out and the corresponding</div><div class="line"> * responses coming back in. Typically interceptors add, remove, or transform headers on the request</div><div class="line"> * or response.</div><div class="line"> */</div></pre></td></tr></table></figure>
<p><code>StreamAllocation</code>协调<code>Connections</code>，<code>Streams</code>和<code>Calls</code>三者之间的关系，该类的文档介绍如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * This class coordinates the relationship between three entities:</div><div class="line"> *</div><div class="line"> * &lt;ul&gt;</div><div class="line"> *     &lt;li&gt;&lt;strong&gt;Connections:&lt;/strong&gt; physical socket connections to remote servers. These are</div><div class="line"> *         potentially slow to establish so it is necessary to be able to cancel a connection</div><div class="line"> *         currently being connected.</div><div class="line"> *     &lt;li&gt;&lt;strong&gt;Streams:&lt;/strong&gt; logical HTTP request/response pairs that are layered on</div><div class="line"> *         connections. Each connection has its own allocation limit, which defines how many</div><div class="line"> *         concurrent streams that connection can carry. HTTP/1.x connections can carry 1 stream</div><div class="line"> *         at a time, SPDY and HTTP/2 typically carry multiple.</div><div class="line"> *     &lt;li&gt;&lt;strong&gt;Calls:&lt;/strong&gt; a logical sequence of streams, typically an initial request and</div><div class="line"> *         its follow up requests. We prefer to keep all streams of a single call on the same</div><div class="line"> *         connection for better behavior and locality.</div><div class="line"> * &lt;/ul&gt;</div><div class="line"> *</div><div class="line"> * &lt;p&gt;Instances of this class act on behalf of the call, using one or more streams over one or more</div><div class="line"> * connections. This class has APIs to release each of the above resources</div><div class="line"> */</div></pre></td></tr></table></figure>
<p>同步请求：直接执行请求，通过 <code>getResponseWithInterceptorChain()</code>获取响应并返回</p>
<p>异步请求：将异步请求（也是一个Runnable）递交给<code>Dispatcher</code>，在其管理的线程池中分发线程执行请求，通过 <code>getResponseWithInterceptorChain()</code>获取响应并回调结果。关键代码逻辑如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// RealCall.enqueue(Callback)方法里的关键代码</span></div><div class="line">client.dispatcher().enqueue(<span class="keyword">new</span> AsyncCall(responseCallback));</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Dispatcher.enqueue(AsyncCall)方法里的关键代码</span></div><div class="line">executorService().execute(call);</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 同步请求与异步请求获取响应的关键代码</span></div><div class="line"><span class="function"><span class="keyword">private</span> Response <span class="title">getResponseWithInterceptorChain</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">    <span class="comment">// Build a full stack of interceptors.</span></div><div class="line">    List&lt;Interceptor&gt; interceptors = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">    interceptors.addAll(client.interceptors());</div><div class="line">    interceptors.add(retryAndFollowUpInterceptor);</div><div class="line">    interceptors.add(<span class="keyword">new</span> BridgeInterceptor(client.cookieJar()));</div><div class="line">    interceptors.add(<span class="keyword">new</span> CacheInterceptor(client.internalCache()));</div><div class="line">    interceptors.add(<span class="keyword">new</span> ConnectInterceptor(client));</div><div class="line">    <span class="keyword">if</span> (!retryAndFollowUpInterceptor.isForWebSocket()) &#123;</div><div class="line">      interceptors.addAll(client.networkInterceptors());</div><div class="line">    &#125;</div><div class="line">    interceptors.add(<span class="keyword">new</span> CallServerInterceptor(</div><div class="line">        retryAndFollowUpInterceptor.isForWebSocket()));</div><div class="line"></div><div class="line">    Interceptor.Chain chain = <span class="keyword">new</span> RealInterceptorChain(</div><div class="line">        interceptors, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="number">0</span>, originalRequest);</div><div class="line">    <span class="keyword">return</span> chain.proceed(originalRequest);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>RouteSelector</code>为连接选择合适的路线，该类的文档介绍如下：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="comment">/**</span></div><div class="line">&gt;  * Selects routes to connect to an origin server. Each connection requires a choice of proxy server,</div><div class="line">&gt;  * IP address, and TLS mode. Connections may also be recycled.</div><div class="line">&gt;  */</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p>HttpEngine 链路和地址选择</p>
<p>支持SPDY，共享同一个Socket来处理同一个服务器的所有请求；如果SPDY不可用，则通过连接池来减少请求延时</p>
<p>连接  <code>Connection</code> <code>HttpConnection</code> </p>
<p>写入数据</p>
<p>数据传输 <code>Transport</code></p>
<p>请求管理<code>Dispatcher</code></p>
<h3 id="底层基础通信"><a href="#底层基础通信" class="headerlink" title="底层基础通信"></a>底层基础通信</h3><ol>
<li>发送请求头</li>
<li>打开一个Sink并写入请求body</li>
<li>关闭Sink</li>
<li>读取响应头</li>
<li>打开一个Source读取响应body</li>
<li>关闭Source</li>
</ol>
<p><code>RouteSelector.next(String method)</code>创建连接</p>
<p><code>ConnectionPool.get(Address address)</code>复用连接</p>
<p><code>ConnectionPool.share(Connection connection)</code>分享SPDY连接</p>
<p><code>Connection.connect(int connectTimeout, int readTimeout, int writeTimeout, Request tunnelRequest)</code>连接</p>
<p><code>Sink</code>用于接收字节流，其功能类似于<code>java.io.OutputStream</code>，该类的文档介绍如下：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="comment">/**</span></div><div class="line">&gt;  * Receives a stream of bytes. Use this interface to write data wherever it's</div><div class="line">&gt;  * needed: to the network, storage, or a buffer in memory. Sinks may be layered</div><div class="line">&gt;  * to transform received data, such as to compress, encrypt, throttle, or add</div><div class="line">&gt;  * protocol framing.</div><div class="line">&gt;  */</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<p><code>Source</code>用于提供字节流，其功能类似于<code>java.io.InputStream</code>，该类的文档介绍如下：</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="comment">/**</span></div><div class="line">&gt;  * Supplies a stream of bytes. Use this interface to read data from wherever</div><div class="line">&gt;  * it's located: from the network, storage, or a buffer in memory. Sources may</div><div class="line">&gt;  * be layered to transform supplied data, such as to decompress, decrypt, or</div><div class="line">&gt;  * remove protocol framing.</div><div class="line">&gt;  */</div><div class="line">&gt;</div></pre></td></tr></table></figure>
</blockquote>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="http://square.github.io/okhttp/" target="_blank" rel="external">okhttp</a></p>
<p><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0326/2643.html" target="_blank" rel="external">OKHttp源码解析 - 泡在网上的日子</a></p>
<p><a href="chrome-extension://klbibkeccnjlkjkiokjodocebajanakg/suspended.html#uri=http://gold.xitu.io/entry/577ddf46a633bd005bf50eef" target="_blank" rel="external">OKHttp源码浅析与最佳实践</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Thea Zhu" />
          <p class="site-author-name" itemprop="name">Thea Zhu</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">18</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">Tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Thea Zhu</span>
</div>

<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
